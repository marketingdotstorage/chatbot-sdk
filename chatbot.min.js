let last_response_id="",isOpen=!1,firstOpen=!0,chat_config={},disabled=!0,addedMessageTmpTracker=!1;const MAX_CHARACTERS=200,CSS_URL=window.UNIT_BOT_CONFIG.css_url||`https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/styles.min.css?v=${Date.now()}`,SERVER_URL=window.UNIT_BOT_CONFIG.server_url||"https://chatbot-api-production-860e.up.railway.app/api/v1",imgMap={"5x5":"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 5x5.png","5x10":"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 5x10.png","10x10":"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 10x10.png","10x15":"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 10x15.png","10x20":"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 10x20.png","10x30":"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 10x30.png",vehiclexstorage:"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - vehicle.png"};function trackEvent(e,t={}){"function"==typeof window.gtag?window.gtag("event",e,t):console.warn("GA not detected. Event not sent:",e)}function getColor(){const e=window.UNIT_BOT_CONFIG.color_page_mapping,t=window.location.pathname;let s;return e&&Object.keys(e).forEach(n=>{t.includes(n)&&(s=e[n])}),s||window.UNIT_BOT_CONFIG.primaryColor||"#e11e30"}function toggleErrorMessage(e){e&&e.length?(document.querySelector("#chatbox-error-message").innerHTML=e,document.querySelector("#chatbox-error-message").style.display="block"):(document.querySelector("#chatbox-error-message").innerHTML="",document.querySelector("#chatbox-error-message").style.display="none")}function initListeners(){document.getElementById("ms-chatbox-wrapper").style.display="none",document.querySelector("#ms-chatbot-fab-btn").addEventListener("click",handleFabClick),document.querySelector("#ms-close-icon").addEventListener("click",function(){isOpen=!1;const e=document.getElementById("ms-chatbox-wrapper");e.style.opacity="0",e.style.transform="translateY(30px)",setTimeout(()=>{e.classList.remove("show"),e.style.display="none"},300)}),document.querySelector("#chatbox-input").addEventListener("keypress",function(e){if("Enter"===e.key){e.preventDefault();const t=document.querySelector("#chatbox-input"),s=t.value.trim();s.length&&s.length>200?toggleErrorMessage("Max message length is 200 characters. "+s.length+" characters entered."):s.length&&(addMessage(s,t),toggleErrorMessage())}}),document.querySelector("#ms-send-btn").addEventListener("click",function(){const e=document.querySelector("#chatbox-input"),t=e.value.trim();t.length&&t.length>200?toggleErrorMessage("Max message length is 200 characters. "+t.length+" characters entered."):t.length&&(addMessage(t,e),toggleErrorMessage())}),setTimeout(()=>{const e=document.getElementById("ms-chatbot-fab-btn");/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&e&&(e.classList.add("show-label"),setTimeout(()=>{e.classList.remove("show-label")},3e3))},1500);const e=document.getElementById("ms-ellipsis-btn"),t=document.getElementById("ms-popover"),s=document.getElementById("ms-reset-chat");e&&e.addEventListener("click",e=>{e.stopPropagation(),togglePopover()}),s&&s.addEventListener("click",e=>{e.stopPropagation(),closePopover(),resetConversation()}),document.addEventListener("click",s=>{if(!t||!e)return;t.contains(s.target)||e.contains(s.target)||closePopover()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&closePopover()})}function addMessage(e,t){if(disabled)return;addedMessageTmpTracker=!0,document.querySelectorAll(".ms-pre-prompt").forEach(e=>{e.remove()}),document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n        <div class="message message-user">\n            <div class="message-content" style="background-color: ${getColor()}">\n                ${e}\n            </div>\n        </div>    \n    `),t&&(t.value=""),disabled=!0,addLoader();const s=document.querySelector("#chatbox-messages");s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),fetch(SERVER_URL+"/chatbot/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,last_response_id:last_response_id,config_id:window.UNIT_BOT_CONFIG.config_id,origin_url:window.location.origin,session_id:localStorage.getItem("ms-unitbot-session-id")||void 0})}).then(async e=>{if(e.ok)return await e.json();{const t=await e.text(),s=new Error("HTTP_ERROR");s.status=e.status;try{const e=JSON.parse(t);s.body=e}catch(e){s.body={message:t}}throw s}}).then(e=>{if(500===e.statusCode)throw new Error(e.message);localStorage.setItem("ms-unitbot-session-id",e.session_id),disabled=!1,document.querySelector("#message-loading").remove(),last_response_id=e.last_response_id;let t="";try{t=JSON.parse(e.data).message}catch(s){t=e.data}insertMessage(e,t);try{const t=JSON.parse(e.data),s=t.intent,n=t.pre_prompted_options;if("request_location"===s&&(addedMessageTmpTracker=!1,navigator.geolocation.getCurrentPosition(async e=>{const t=await getZipCode(e.coords.latitude,e.coords.longitude);t&&!addedMessageTmpTracker?(addMessage(t),trackEvent("unitbot_location",{config_id:window.UNIT_BOT_CONFIG.config_id,location:t,session_id:localStorage.getItem("ms-unitbot-session-id")})):trackEvent("unitbot_location",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")})},()=>{trackEvent("unitbot_location",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")})})),n&&Array.isArray(n)&&n.length&&"request_location"!==s){const e=n.filter(Boolean).map(e=>String(e).trim()).filter(e=>e.length).slice(0,8);e.length&&document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n                    <div class="message ms-pre-prompt">\n                        <div class="ms-quick-replies" role="list">\n                        ${e.map(e=>`\n                            <button type="button" class="ms-quick-reply" role="listitem" onclick="addMessage('${e}')">\n                                ${e}\n                            </button>\n                        `).join("")}\n                        </div>\n                    </div>\n                    `)}}catch(e){}const s=document.querySelector("#chatbox-messages");s.scrollTo({top:s.scrollHeight,behavior:"smooth"})}).catch(e=>{e.body||e.body.message?"CHAT_SESSION_TOO_LONG"===e.body.message?(document.querySelector("#chatbox-messages").innerHTML="",localStorage.removeItem("ms-unitbot-session-id"),last_response_id="",setTimeout(()=>{handleFirstLoad()},1)):429===e.status?(document.querySelector("#message-loading").remove(),disabled=!1,toggleErrorMessage("Rate limit reached. Please try again in a few moments.")):(document.querySelector("#message-loading").remove(),disabled=!1,toggleErrorMessage("An unknown error has occured. Please try again shortly")):(document.querySelector("#message-loading").remove(),disabled=!1,toggleErrorMessage("An unknown error has occured. Please try again shortly")),disabled=!1})}function addLoader(){document.querySelector("#message-loading")&&document.querySelector("#message-loading").remove(),document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",'\n        <div class="message" id="message-loading">\n            <div class="message-avatar">\n                <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n            </div>\n                                \n            <div class="message-content">\n                <div class="loader"></div>\n            </div>\n        </div>    \n    ')}function showMore(){document.querySelectorAll(".ms-hidden").forEach(e=>{e.classList.remove("ms-hidden")});document.querySelectorAll(".ms-show-more-btn").forEach(e=>{e.classList.add("ms-hidden")})}function insertMessage(e,t){if(e.facilities&&e.facilities.length&&e.facilities.forEach(e=>{document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n                <div class="message">\n                    <div class="message-avatar">\n                        <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                    </div>\n\n                    <div class="message-content ms-facility-message">\n                        <div>\n                            <div class="facility-name">${e.name}</div>\n                            <div class="address">${e.address.full_address}, ${e.address.state}, ${e.address.postal}</div>\n                        </div>\n                        <svg onclick="addMessage('${e.name}')" class="select-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">\n                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m10 16 4-4-4-4"/>\n                        </svg>\n                    </div>\n                </div>\n            `)}),e.units&&e.units.length&&(trackEvent("unitbot_recommend_unit",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")}),e.units.forEach(e=>{const t=e.rent_url?new URL(e.rent_url):"";t&&t.searchParams.append("utm_unitbot_assisted",!0);const s=e.features&&Array.isArray(e.features)?e.features:[];let n='<div class="ms-features-wrapper">';s.forEach((e,t)=>{n+=0===t?`<span>${e}</span>`:`<span class="${t>2?"ms-hidden":""}">, ${e}</span>`}),s.length>=3&&(n+='<span class="ms-show-more-btn" onclick="showMore()">Show more</span>'),n+="</div>",document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n                <div class="message">\n                    <div class="message-avatar">\n                        <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                    </div>\n                                    \n                    <div class="message-content ms-unit-message">\n                        <img src="${getImageUrl(e.dimensions)}" />\n                        <div class="ms-unit-details">\n                            <div>${e.size} for $${e.price}</div>\n\n                            ${n}\n\n                            <div class="ms-unit-ctas">\n                                ${e.rent_url?`<div onclick="rentUnit('${e.pricingGroupId}', '${t.toString()}')" style="background-color: ${getColor()};">Rent Now</div>`:""}\n                                ${e.reserve_url?`<a href="${e.reserve_url}"><div style="background-color: ${getColor()};">Reserve</div></a>`:""}\n                            </div>\n                        </div>\n                    </div>\n                </div>    \n            `)})),e.support_url){trackEvent("unitbot_send_to_support",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")});const t=new URL(e.support_url);t.searchParams.append("utm_unitbot_assisted",!0),document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n            <div class="message">\n                <div class="message-avatar">\n                    <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                </div>\n                                    \n                <div class="message-content">\n                    <a href="${t.toString()}" style="color: ${getColor()}">Support URL</a>\n                </div>\n            </div>    \n        `)}t.length&&document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n            <div class="message">\n                <div class="message-avatar">\n                    <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                </div>\n                                    \n                <div class="message-content">\n                    ${t}\n                </div>\n            </div>    \n        `)}async function getZipCode(e,t){const s=`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${t}&format=json`,n=await fetch(s,{headers:{"User-Agent":"Unitbot/1.0"}}),o=await n.json();return o?.address?.postcode||null}async function handleFirstLoad(){addLoader();try{const e=localStorage.getItem("ms-unitbot-session-id");if(!e)throw Error("No session");{const t=await fetch(SERVER_URL+"/chatbot/session/"+e,{headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Fetch failed with status ${t.status}`);const{data:s}=await t.json();document.querySelector("#message-loading")&&document.querySelector("#message-loading").remove(),s&&s.chat_history&&s.chat_history.length&&s.chat_history.forEach(e=>{"user"===e.from?document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",`\n                            <div class="message message-user">\n                                <div class="message-content" style="background-color: ${getColor()}">\n                                    ${e.content.message}\n                                </div>\n                            </div>    \n                        `):insertMessage(e,e.content.message)});const n=document.querySelector("#chatbox-messages");n.scrollTo({top:n.scrollHeight,behavior:"instant"}),disabled=!1}}catch(e){localStorage.removeItem("ms-unitbot-session-id"),addLoader(),disabled=!1,setTimeout(()=>{document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",'\n                <div class="message">\n                    <div class="message-avatar">\n                        <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                    </div>\n                    <div class="message-content">\n                        Hello! I am UnitBot, your storage assistant. I\'m here to get you into the best storage unit today.\n                    </div>\n                </div>\n            '),document.querySelector("#chatbox-messages").insertAdjacentHTML("beforeend",'\n                <div class="message">\n                    <div class="message-avatar">\n                        <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                    </div>\n                    <div class="message-content">\n                        What do you need to store?\n                    </div>\n                </div>\n            '),document.querySelector("#message-loading").remove()},1e3)}}function handleFabClick(){isOpen=!isOpen,firstOpen&&(handleFirstLoad(),trackEvent("unitbot_open",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")}));const e=document.getElementById("ms-chatbox-wrapper");isOpen?(e.style.display="block",e.style.opacity="",e.style.transform="",e.offsetWidth,e.classList.add("show")):(e.classList.remove("show"),trackEvent("unitbot_end",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")}),setTimeout(()=>{e.style.display="none"},300)),firstOpen=!1}function rentUnit(e,t){const s="10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16));localStorage.setItem("@CUBBY/CART",JSON.stringify({cartId:s,pricingGroups:[e],selectedValueTier:null})),trackEvent("unitbot_send_to_payment",{config_id:window.UNIT_BOT_CONFIG.config_id,session_id:localStorage.getItem("ms-unitbot-session-id")}),window.location.href=t}function getImageUrl(e){const t=imgMap[`${e[0]}x${e[1]}`];return t||"https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/Unit - NoSize - 5x10.png"}function resetConversation(){const e=document.querySelector("#chatbox-messages");e&&(e.innerHTML=""),localStorage.removeItem("ms-unitbot-session-id"),last_response_id="",addedMessageTmpTracker=!1,disabled=!1,handleFirstLoad()}function closePopover(){const e=document.getElementById("ms-popover"),t=document.getElementById("ms-ellipsis-btn");e&&t&&(e.classList.remove("open"),e.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false"))}function togglePopover(){const e=document.getElementById("ms-popover"),t=document.getElementById("ms-ellipsis-btn");if(!e||!t)return;!e.classList.contains("open")?(e.classList.add("open"),e.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true")):closePopover()}!function(){const e=`\n            <div class="chatbox-box" id="ms-chatbox-wrapper">\n                <div class="chatbox-header" style="background-color: ${getColor()}">\n                    <div class="chatbot-avatar">\n                        <img src="https://cdn.jsdelivr.net/gh/marketingdotstorage/chatbot-sdk@main/assets/unitbot.png" />\n                        <div class="chatbot-status">\n                            <div>UnitBot <span class="beta-badge">BETA</span></div>\n                            <div>\n                                <div class="status-icon"></div>\n                                <div>Online Now</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="ms-header-actions">\n                        <button type="button" class="ms-ellipsis-btn" id="ms-ellipsis-btn" aria-label="More options" aria-haspopup="menu" aria-expanded="false">\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="ms-ellipsis-icon">\n                            <path d="M5.25 10.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm6.75 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm6.75 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"/>\n                            </svg>\n                        </button>\n\n                        <div class="ms-popover" id="ms-popover" role="menu" aria-hidden="true">\n                            <button type="button" class="ms-popover-item" id="ms-reset-chat" role="menuitem">\n                            Reset conversation\n                            </button>\n                        </div>\n\n                        <div class="chatbot-close">\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="ms-close-icon" id="ms-close-icon">\n                            <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n                <div class="chatbox-messages" id="chatbox-messages"></div>\n                <div class="chatbox-error-message" id="chatbox-error-message" style="display: none;"></div>\n                <div class="chatbot-send">\n                    <input type="text" id="chatbox-input" placeholder="Reply to UnitBot" />\n                    <button id="ms-send-btn" style="background-color: ${getColor()}">Send</button>\n                </div>\n            </div>\n            <div class="chatbot-fab-wrapper" id="chatbot-fab-wrapper">\n                <div class="chatbot-fab" id="ms-chatbot-fab-btn" style="background-color: ${getColor()}">\n                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="ms-chat-icon">\n                        <path fill-rule="evenodd" d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52 1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97a48.901 48.901 0 0 1-3.476.383.39.39 0 0 0-.297.17l-2.755 4.133a.75.75 0 0 1-1.248 0l-2.755-4.133a.39.39 0 0 0-.297-.17 48.9 48.9 0 0 1-3.476-.384c-1.978-.29-3.348-2.024-3.348-3.97V6.741c0-1.946 1.37-3.68 3.348-3.97ZM6.75 8.25a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H7.5Z" clip-rule="evenodd" />\n                    </svg>\n                    <span class="chatbot-fab-label">I'll help you rent!</span>\n                </div>\n            </div>\n    `,t=document.createElement("link");t.rel="stylesheet",t.href=CSS_URL,document.head.appendChild(t),t.onload=()=>{const t=document.createElement("div");t.classList.add("ms-chatbot-container"),t.innerHTML=e,document.body.appendChild(t),initListeners(),fetch(SERVER_URL+"/chatconfig/"+window.UNIT_BOT_CONFIG.config_id,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e&&(chat_config=e)})}}();